%h2= "#{@data_response.data_request.title}: response from #{@data_response.organization.name}"

.simple_table

  %table.projects
    %thead
      %tr
        %th Project
        %th Activities
        %th Spend
        %th Total Budget

    %tbody
      - @projects.each do |project|
        %tr.project.entry_header
          %td
            %ul
              %li= project.name
              %li.descr= project.description.to_s.first(300)
              %li.funders= "Funders: #{project.funding_sources.map(&:name).join(', ')}"
          %td= project.activities.count
          %td= number_to_currency(project.spend, :unit => project.currency.to_s + ' ', :separator => ".", :delimiter => ",")
          %td= number_to_currency(project.entire_budget, :unit => project.currency.to_s + ' ', :separator => ".", :delimiter => ",")

        %tr.project.entry_main
          %td{:colspan => 100}
            %dl
              %dt Districts:
              %dd= project.locations
              %dt Start:
              %dd= project.start_date
              %dt End:
              %dd= project.end_date
              %dt Total Budget:
              %dd= project.entire_budget
              %dt Budget (current FY):
              %dd= project.budget
              %dt Spend Q4 (Previous FY):
              %dd= project.spend_q4_prev
              %dt Spend (current FY):
              %dd= project.spend
              %dt Spend Q1:
              %dd= project.spend_q1
              %dt Spend Q2:
              %dd= project.spend_q2
              %dt Spend Q3:
              %dd= project.spend_q3
              %dt Spend Q4:
              %dd= project.spend_q4

            %table.activities
              %thead
                %tr
                  %th Activity
                  %th Sub-Implementers
                  %th Spend
                  %th Budget
              %tbody
                - project.activities.each do |activity|
                  %tr.activity.entry_header
                    %td
                      %ul
                        %li.name= activity.name
                        %li.descr= activity.description.to_s.first(300)
                        %li.implementer= "Implementer: #{activity.implementer.name}"
                    %td= activity.sub_activities.count
                    %td= number_to_currency(activity.spend, :unit => activity.currency.to_s + ' ', :separator => ".", :delimiter => ",")
                    %td= number_to_currency(activity.budget, :unit => activity.currency.to_s + ' ', :separator => ".", :delimiter => ",")
                  %tr.activity.entry_main
                    %td{:colspan => 100}
                      %dl
                        %dt Districts:
                        %dd= activity.locations
                        %dt Start:
                        %dd= activity.start
                        %dt End:
                        %dd= activity.end
                        %dt Beneficiaries:
                        %dd= activity.beneficiaries.map(&:short_display).join(', ')
                        %dt Org's Assisted
                        %dd= activity.organizations.map(&:name).join(', ')
                        %dt Comments
                        %dd
                      %table.classifications
                        %thead
                          %tr
                            %th Classification
                            %th Completed?
                        %tbody
                          %tr.classification.entry_header
                            %td Budget by Coding
                            %td= activity.budget?
                          %tr
                            %td Budget by District
                            %td= activity.budget_by_district?
                          %tr
                            %td Budget by Cost Category
                            %td= activity.budget_by_cost_category?
                          %tr
                            %td Expenditure by Coding
                            %td
                              = activity.spend?
                              %tr
                            %td Expenditure by District
                            %td= activity.spend_by_district?
                          %tr
                            %td Expenditure by Cost Category
                            %td= activity.spend_by_cost_category?
