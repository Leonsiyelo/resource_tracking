- title("Projects")

= render :partial => 'projects/sub_nav'

%h1.main_heading
  = render 'search'
  Projects

= render 'getting_started'

%ul.response-notice
  - @projects.each do |project|
    - if project.budget != (project.activities_budget_total + project.other_costs_budget_total)
      %li= "The Projects (#{project.name}) Budget should match the total expenditures for Activities plus Other Costs. Please update your activities/other costs for this project accordingly accordingly."
    - if project.spend != (project.activities_spend_total + project.other_costs_spend_total)
      %li= "The Projects (#{project.name}) Expenditure (Spend) should match the total expenditures for Activities plus Other Costs. Please update your activities/other costs for this project accordingly accordingly."
    - if !project.linked?
      %li= "The Project (#{project.name}) is not currently linked."

%ul.horizontal
  %li
    - link_to new_response_project_path(@response), :class => "create_new" do
      = image_tag "new_white.png"
      Create Project

  %li
    = link_to "File Import", '#', :id => "csv_file", :class => 'create_new'

  %li
    = link_to "Link Projects", bulk_edit_response_projects_path, :class => 'create_new'

#import
  %h3.title_bar Import a CSV file
  .dashboard_section
    %p Create one or more projects from a CSV file. You can save an Excel spreadsheet as a CSV file through File -> Save As, then select comma separated values (CSV) in the file format box under the file name.

    #import_csv
      - form_tag({:action=> :create_from_file}, :multipart => true) do
        =label_tag :file, "File"
        =file_field_tag :file
        =submit_tag "Upload and Import", :class => 'small_submit_button'
      = link_to "Download template", download_template_response_projects_path(@response), :class => 'target'

- if params[:query]
  %p
    = "Projects with names containing #{params[:query]}"
    = link_to "(Back to complete project listing)", response_projects_path(@response)

%table.sum.rounded
  %thead
    %tr
      %th= sortable "project"
      %th= sortable "spend", "Total Spent"
      %th= sortable "budget", "Total Budget"

  %tbody
    - unless @projects.empty?
      - @projects.each do |project|
        = render "project", :project => project
    - else
      %tr
        %td{:colspan => 100}
          = render 'no_projects_yet'


= will_paginate @projects

%ul{ :id => 'position_container', :class => 'image_list' }
